<!DOCTYPE html>
<html lang="en" class="h-100">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AutoManim</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- CodeMirror CSS -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/theme/dracula.min.css"
    />

    <!-- CodeMirror JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/mode/python/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/matchbrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/edit/closebrackets.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.13/addon/comment/comment.min.js"></script>

    <!-- Custom styles -->
    <style>
      /* Essential variables */
      :root {
        --primary: #6366f1;
        --primary-light: rgba(79, 70, 229, 0.3);
        --border: rgba(71, 85, 105, 0.3);
        --scrollbar: rgba(74, 85, 104, 0.6);
        --dark-bg: #1e1e2e;
        --dark-bg-lighter: #2a2a40;
        --dark-border: #3a3a50;
      }

      /* Base layout */
      html,
      body {
        height: 100%;
        background: linear-gradient(to bottom right, #0f172a, #1e1e2e, #0f172a);
        color: #f8f8f2;
      }

      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }

      main {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 10;
      }

      /* Grid pattern overlay */
      .grid-pattern {
        position: fixed;
        inset: 0;
        background-image: url('{{ url_for("static", filename="img/grid-pattern.svg") }}');
        opacity: 0.02;
        pointer-events: none;
      }

      /* Glass panel styling */
      .glass-panel {
        background: rgba(17, 24, 39, 0.5);
        backdrop-filter: blur(5px);
        border: 1px solid var(--dark-border);
        border-radius: 0.75rem;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        padding: 1rem;
      }

      .glass-content {
        background: rgba(15, 23, 42, 0.5);
        backdrop-filter: blur(5px);
        border: 1px solid var(--dark-border);
        border-radius: 0.5rem;
      }

      .glass-input {
        background: rgba(15, 23, 42, 0.5);
        border: 1px solid var(--dark-border);
        color: #f8f8f2;
      }

      .glass-input:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 0.25rem rgba(99, 102, 241, 0.25);
      }

      .glass-button {
        background: var(--primary);
        color: white;
        transition: all 0.2s;
      }

      .glass-button:hover {
        transform: translateY(-1px);
        background: rgba(99, 102, 241, 0.9);
      }

      /* Header styling */
      .custom-header {
        background: rgba(15, 23, 42, 0.6);
        backdrop-filter: blur(8px);
        border-bottom: 1px solid rgba(71, 85, 105, 0.3);
        padding: 0.75rem 1rem;
      }

      .app-title {
        font-weight: bold;
        color: white;
      }

      .app-title span {
        color: #818cf8;
        margin-right: 0.25rem;
      }

      /* Code editor styling */
      .CodeMirror {
        height: 100%;
        font: 14px/1.5 monospace;
        border: 1px solid var(--dark-border);
        border-radius: 0.5rem;
      }

      .CodeMirror-gutters {
        background: rgba(30, 41, 59, 0.5);
        border-right: 1px solid var(--border);
      }

      .code-editor-container {
        display: flex;
        flex-direction: column;
      }

      /* Chat messages */
      .user-message,
      .assistant-message {
        max-width: 90%;
        margin-bottom: 0.5rem;
        padding: 0.75rem 1rem;
        border-radius: 0.75rem;
      }

      .user-message {
        background: var(--primary-light);
        border: 1px solid var(--primary-light);
        margin-left: auto;
        color: #f8f8f2;
      }

      .assistant-message {
        background: rgba(30, 41, 59, 0.5);
        border: 1px solid var(--border);
        margin-right: auto;
        color: #e2e8f0;
      }

      /* Scrollbars */
      .chat-container,
      #log-display.active,
      .CodeMirror {
        scrollbar-width: thin;
        scrollbar-color: var(--scrollbar) rgba(30, 41, 59, 0.5);
      }

      .chat-container::-webkit-scrollbar,
      #log-display::-webkit-scrollbar,
      .CodeMirror::-webkit-scrollbar {
        width: 5px;
      }

      .chat-container::-webkit-scrollbar-thumb,
      #log-display::-webkit-scrollbar-thumb,
      .CodeMirror::-webkit-scrollbar-thumb {
        background: var(--scrollbar);
        border-radius: 4px;
      }

      /* Status and logs */
      #status-message {
        transition: all 0.3s;
      }

      #status-container {
        border-left: 2px solid;
      }

      .bg-success-custom {
        background: rgba(6, 78, 59, 0.2);
        border-color: #10b981;
      }

      .bg-danger-custom {
        background: rgba(127, 29, 29, 0.2);
        border-color: #ef4444;
      }

      .bg-primary-custom {
        background: rgba(49, 46, 129, 0.2);
        border-color: #6366f1;
      }

      /* Log display */
      #log-display {
        transition: all 0.3s;
        max-height: 0;
        opacity: 0;
        overflow: hidden;
      }

      #log-display.active {
        opacity: 1;
        max-height: 150px;
        overflow-y: auto;
      }

      .log-line {
        padding-left: 15px;
        position: relative;
        font: 0.7rem monospace;
        line-height: 1.8;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        color: #6ee7b7;
      }

      .log-line::before {
        content: ">";
        position: absolute;
        left: 0;
        color: #818cf8;
      }

      .log-line.rendering-progress {
        color: #a5b4fc;
      }

      .log-line.error {
        color: #f87171;
      }

      .log-line.success {
        color: #6ee7b7;
      }

      /* Utility classes */
      .icon-md {
        width: 1.25rem;
        height: 1.25rem;
        margin-right: 0.5rem;
      }

      .absolute-center-right {
        position: absolute;
        right: 0.75rem;
        top: 50%;
        transform: translateY(-50%);
      }

      .terminal-header {
        background: rgba(15, 23, 42, 0.8);
        border-bottom: 1px solid #3a3a50;
      }

      .terminal-dot {
        width: 0.5rem;
        height: 0.5rem;
        border-radius: 50%;
        display: inline-block;
      }

      .chat-container {
        min-height: 180px;
        max-height: 350px;
        overflow-y: auto;
      }

      .section-title {
        color: #a5b4fc;
        font-weight: bold;
        font-size: 1.1rem;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
      }

      .section-title svg {
        color: #818cf8;
        margin-right: 0.5rem;
      }

      .min-h-400 {
        min-height: 400px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .spinner {
        animation: spin 1s linear infinite;
      }
    </style>
  </head>

  <body>
    <div class="grid-pattern"></div>

    <!-- Header -->
    <header class="custom-header shadow-sm mb-3">
      <div class="container d-flex justify-content-between align-items-center">
        <h1 class="app-title fs-4 mb-0"><span>Auto</span>Manim</h1>
        <button id="clear-chat-btn" class="btn btn-sm btn-outline-secondary">
          Clear Chat
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container py-2">
      <div class="row g-4">
        <!-- Code Editor -->
        <div class="col-lg-8">
          <div class="glass-panel d-flex flex-column h-100">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <h2 class="section-title mb-0">
                <svg
                  width="20"
                  height="20"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z"
                  ></path>
                </svg>
                MANIM Code
              </h2>
              <div class="d-flex gap-2">
                <button
                  id="toggle-editor-button"
                  class="btn btn-sm btn-outline-secondary"
                >
                  <span id="toggle-editor-text">Show Editor</span>
                </button>
                <button id="execute-button" class="btn btn-sm glass-button">
                  <span>Execute</span>
                  <svg
                    id="execute-spinner"
                    class="spinner d-none"
                    width="16"
                    height="16"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                  >
                    <circle
                      class="opacity-25"
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      stroke-width="4"
                    ></circle>
                    <path
                      class="opacity-75"
                      fill="currentColor"
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                    ></path>
                  </svg>
                </button>
              </div>
            </div>

            <div id="status-message" class="mb-3 d-none">
              <div class="px-3 py-2 rounded" id="status-container">
                <p id="status-text" class="small mb-0">Processing...</p>
              </div>
            </div>

            <!-- Code Preview -->
            <div
              id="code-preview"
              class="glass-content flex-grow-1 d-flex flex-column align-items-center justify-content-center p-4"
            >
              <div class="text-center" style="max-width: 400px">
                <svg
                  class="mb-3 opacity-75"
                  width="40"
                  height="40"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg"
                  style="color: #818cf8"
                >
                  <path
                    fill-rule="evenodd"
                    d="M12.316 3.051a1 1 0 01.633 1.265l-4 12a1 1 0 11-1.898-.632l4-12a1 1 0 011.265-.633zM5.707 6.293a1 1 0 010 1.414L3.414 10l2.293 2.293a1 1 0 11-1.414 1.414l-3-3a1 1 0 010-1.414l3-3a1 1 0 011.414 0zm8.586 0a1 1 0 011.414 0l3 3a1 1 0 010 1.414l-3 3a1 1 0 11-1.414-1.414L16.586 10l-2.293-2.293a1 1 0 010-1.414z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
                <h3 class="fw-medium mb-1" style="color: #a5b4fc">
                  Your Manim code is ready
                </h3>
                <p class="text-secondary small mb-3">
                  This code will animate the visualization when executed.
                </p>
                <div
                  class="bg-dark bg-opacity-50 rounded py-2 px-3 d-inline-block mb-3"
                >
                  <span style="color: #a5b4fc; font-family: monospace"
                    ><span id="code-preview-lines">0</span> lines of code</span
                  >
                </div>
                <button
                  id="preview-show-editor"
                  class="btn btn-sm btn-outline-primary mx-auto d-flex align-items-center"
                >
                  <svg
                    class="me-1"
                    width="16"
                    height="16"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"
                    ></path>
                  </svg>
                  Edit Code
                </button>
              </div>
            </div>

            <!-- Code Editor (hidden by default) -->
            <div
              id="code-editor-container"
              class="code-editor-container w-100 flex-grow-1 d-none min-h-400"
            >
              <textarea id="manim-code" class="d-none">
from manim import *

class CreateCircle(Scene):
    def construct(self):
        circle = Circle()
        circle.set_fill(PINK, opacity=0.5)
        self.play(Create(circle))</textarea
              >
            </div>
          </div>
        </div>

        <!-- Right column: Video Player and Chat -->
        <div class="col-lg-4">
          <div class="d-flex flex-column gap-4 h-100">
            <!-- Video Player -->
            <div class="glass-panel">
              <h2 class="section-title">
                <svg
                  width="20"
                  height="20"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
                Generated Video
              </h2>

              <!-- Video container with overlay -->
              <div class="position-relative mb-2">
                <div class="ratio ratio-16x9 bg-dark rounded overflow-hidden">
                  <div
                    id="video-overlay"
                    class="position-absolute top-0 start-0 w-100 h-100 bg-dark bg-opacity-90 d-none justify-content-center align-items-center"
                    style="backdrop-filter: blur(4px); z-index: 10"
                  >
                    <div class="text-center">
                      <svg
                        class="spinner mb-3"
                        width="40"
                        height="40"
                        style="color: #818cf8"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                      >
                        <circle
                          class="opacity-25"
                          cx="12"
                          cy="12"
                          r="10"
                          stroke="currentColor"
                          stroke-width="4"
                        ></circle>
                        <path
                          class="opacity-75"
                          fill="currentColor"
                          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                        ></path>
                      </svg>
                      <p class="small fw-medium mb-1" style="color: #a5b4fc">
                        Generating animation...
                      </p>
                      <p class="text-secondary small">This may take a moment</p>
                    </div>
                  </div>
                  <video
                    id="output-video"
                    controls
                    class="w-100 h-100 object-fit-contain"
                  >
                    <source src="#" type="video/mp4" />
                  </video>
                </div>
              </div>

              <!-- Terminal console -->
              <div class="bg-dark bg-opacity-50 rounded overflow-hidden">
                <div
                  class="terminal-header d-flex justify-content-between align-items-center px-3 py-2"
                >
                  <div class="d-flex gap-2">
                    <span class="terminal-dot bg-danger opacity-75"></span>
                    <span class="terminal-dot bg-warning opacity-75"></span>
                    <span class="terminal-dot bg-success opacity-75"></span>
                  </div>
                  <span
                    class="text-secondary small"
                    style="font-family: monospace"
                    >Manim Progress</span
                  >
                  <div style="width: 2rem"></div>
                </div>
                <div id="log-display">
                  <div
                    id="log-lines"
                    class="p-2 font-monospace small"
                    style="font-size: 0.7rem"
                  ></div>
                </div>
              </div>
            </div>

            <!-- Chat Interface -->
            <div class="glass-panel flex-grow-1 d-flex flex-column">
              <h2 class="section-title">
                <svg class="icon-md" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"
                    clip-rule="evenodd"
                  />
                </svg>
                Chat
              </h2>

              <!-- Chat container -->
              <div
                id="chat-container"
                class="chat-container glass-content p-3 flex-grow-1"
              >
                <div class="text-center py-4 opacity-50">
                  <svg class="mb-2" width="32" height="32" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  <span class="text-secondary small"
                    >Start a conversation with AutoManim</span
                  >
                </div>
              </div>

              <!-- Chat input -->
              <div class="d-flex gap-2 mt-3">
                <div class="flex-grow-1 position-relative">
                  <input
                    type="text"
                    id="manim-prompt"
                    placeholder="Enter your prompt..."
                    class="form-control glass-input"
                  />
                  <div
                    id="generate-prompt-spinner"
                    class="absolute-center-right d-none"
                  >
                    <svg
                      class="spinner"
                      width="16"
                      height="16"
                      style="color: #818cf8"
                      viewBox="0 0 24 24"
                    >
                      <circle
                        class="opacity-25"
                        cx="12"
                        cy="12"
                        r="10"
                        stroke="currentColor"
                        stroke-width="4"
                      />
                      <path
                        class="opacity-75"
                        fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                      />
                    </svg>
                  </div>
                </div>
                <button
                  id="generate-button"
                  type="button"
                  class="btn glass-button px-3 d-flex align-items-center"
                >
                  <span>Send</span>
                  <svg
                    id="generate-spinner"
                    class="spinner ms-1 d-none"
                    width="16"
                    height="16"
                    viewBox="0 0 24 24"
                  >
                    <circle
                      class="opacity-25"
                      cx="12"
                      cy="12"
                      r="10"
                      stroke="currentColor"
                      stroke-width="4"
                    />
                    <path
                      class="opacity-75"
                      fill="currentColor"
                      d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- App JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
  </body>
</html>
